<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="font" href="/_next/static/media/2aaf0723e720e8b9-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/b89f66ecdb077e7f-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/494afaf338ab5c7d.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/7c9a1029ba1c2cf7.css" data-precedence="next"/><link rel="preload" href="/_next/static/chunks/webpack-9747723084e35360.js" as="script" fetchPriority="low"/><script src="/_next/static/chunks/fd9d1056-a99b58d3cc150217.js" async=""></script><script src="/_next/static/chunks/596-ff6b9f15ce906e24.js" async=""></script><script src="/_next/static/chunks/main-app-4f41eba75df82bd8.js" async=""></script><title>Short Post</title><meta name="description" content="Using keras progress bars in custom python code"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="bg-[#1a1a1a] text-neutral-200 __className_20951f"><main class="flex min-h-screen flex-col items-center py-16 md:py-32 px-6"><div class="max-w-lg w-full flex flex-col"><div class="mb-7 font-light">↖ <a rel="" target="" class=" text-neutral-200 underline underline-offset-2 transition-all duration-200 decoration-neutral-600 hover:decoration-neutral-400" href="/blog">Back</a></div><article class="__className_bfc3c1 leading-7 antialiased"><h1>Short Post</h1><p class="text-neutral-500">27 October 2020</p><div><p>I really like the progress bars in keras API. So, this is how to add those progress bars in any python code.</p>
<p>Example with pytorch training loop.</p>
<pre><code class="language-python">import tensorflow as tf

n_epochs = 3
for epoch in range(n_epochs):
    n_batches = len(dataloader)
    print(f&#39;Epoch {epoch+1}/{n_epochs}&#39;)
    pbar = tf.keras.utils.Progbar(target=n_batches)
    for idx, batch in enumerate(dataloader):
        train_loss = train_step(batch)
        pbar.update(idx, values=[(&quot;loss&quot;,train_loss)])
    val_loss = validate()
    pbar.update(n_batches, values=[(&#39;val_loss&#39;, val_loss)])
</code></pre>
<p>Output:</p>
<pre><code class="language-text">Epoch 1/3
10/10 [==============================] - 2s 225ms/step - loss: 0.4698 - val_loss: 0.9111
Epoch 2/3
10/10 [==============================] - 2s 226ms/step - loss: 0.4626 - val_loss: 0.8433
Epoch 3/3
10/10 [==============================] - 2s 225ms/step - loss: 0.5835 - val_loss: 0.4997
</code></pre>
<p>Notes:  </p>
<ul>
<li>The metrics shown along with the progress bar are being averaged over each update.<br>So if the loss values for each batch over an epoch were [5,4,3,2,1], you would see the values [5, 4.5, 4, 3.5, 3] as the progress bar fills up.
If you need the raw values, you need to add an argument to the instantiation of the progress bar.
e.g.<pre><code class="language-python">pbar = tf.keras.utils.Progbar(target=n_batches, stateful_metrics=[&#39;loss&#39;])
</code></pre>
This would make the progress bar not average the values corresponding to the key <code>loss</code> during each update.</li>
<li>It&#39;s important to &quot;finish&quot; the progress bar by having the final <code>update</code> function contain the first argument as 
the <code>target</code> or total number of iterations set in the progress bar. e.g. The total in the progress bar was the number of batches or <code>n_batches</code>.
So, if you were skipping the validation step, you would still need to call <pre><code class="language-python">pbar.update(n_batches, values=None)
</code></pre>
after all the training batches were processed, to finish the progress bar. And it would only show the training loss this time.<br>Failing to do so will result in incomplete progress bars for each iterations that look like this.<pre><code class="language-text">Epoch 1/3
9/10 [==========================&gt;...] - ETA: 0s - loss: 0.4153Epoch 2/3
9/10 [==========================&gt;...] - ETA: 0s - loss: 0.4637Epoch 3/3
9/10 [==========================&gt;...] - ETA: 0s - loss: 0.5152
</code></pre>
</li>
</ul>
</div></article></div></main><script src="/_next/static/chunks/webpack-9747723084e35360.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/2aaf0723e720e8b9-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/494afaf338ab5c7d.css\",{\"as\":\"style\"}]\n0:\"$L3\"\n"])</script><script>self.__next_f.push([1,"4:HL[\"/_next/static/media/b89f66ecdb077e7f-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n5:HL[\"/_next/static/css/7c9a1029ba1c2cf7.css\",{\"as\":\"style\"}]\n"])</script><script>self.__next_f.push([1,"6:I{\"id\":7948,\"chunks\":[\"272:static/chunks/webpack-9747723084e35360.js\",\"971:static/chunks/fd9d1056-a99b58d3cc150217.js\",\"596:static/chunks/596-ff6b9f15ce906e24.js\"],\"name\":\"default\",\"async\":false}\n8:I{\"id\":6628,\"chunks\":[\"272:static/chunks/webpack-9747723084e35360.js\",\"971:static/chunks/fd9d1056-a99b58d3cc150217.js\",\"596:static/chunks/596-ff6b9f15ce906e24.js\"],\"name\":\"\",\"async\":false}\n9:I{\"id\":7767,\"chunks\":[\"272:static/chunks/webpack-9747723084e35360.js\",\"971:static/chunks/fd9d1056-a99b58d3cc150217.js\",\"5"])</script><script>self.__next_f.push([1,"96:static/chunks/596-ff6b9f15ce906e24.js\"],\"name\":\"default\",\"async\":false}\na:I{\"id\":7920,\"chunks\":[\"272:static/chunks/webpack-9747723084e35360.js\",\"971:static/chunks/fd9d1056-a99b58d3cc150217.js\",\"596:static/chunks/596-ff6b9f15ce906e24.js\"],\"name\":\"default\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/494afaf338ab5c7d.css\",\"precedence\":\"next\"}]],[\"$\",\"$L6\",null,{\"buildId\":\"KnsO8z-ENGbRNQP4VRChH\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/keras-progress-bar-pytorch/\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"keras-progress-bar-pytorch\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"keras-progress-bar-pytorch\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L7\"],\"globalErrorComponent\":\"$8\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"bg-[#1a1a1a] text-neutral-200 __className_20951f\",\"children\":[\"$\",\"main\",null,{\"className\":\"flex min-h-screen flex-col items-center py-16 md:py-32 px-6\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-lg w-full flex flex-col\",\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",[\"slug\",\"keras-progress-bar-pytorch\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Lb\",\"$Lc\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"keras-progress-bar-pytorch\\\"}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/7c9a1029ba1c2cf7.css\",\"precedence\":\"next\"}]]}],\"segment\":[\"slug\",\"keras-progress-bar-pytorch\",\"d\"]},\"styles\":[]}],\"segment\":\"blog\"},\"styles\":[]}]}]}]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Short Post\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Using keras progress bars in custom python code\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\nb:null\n"])</script><script>self.__next_f.push([1,"d:Ta2d,"])</script><script>self.__next_f.push([1,"\u003cp\u003eI really like the progress bars in keras API. So, this is how to add those progress bars in any python code.\u003c/p\u003e\n\u003cp\u003eExample with pytorch training loop.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003eimport tensorflow as tf\n\nn_epochs = 3\nfor epoch in range(n_epochs):\n    n_batches = len(dataloader)\n    print(f\u0026#39;Epoch {epoch+1}/{n_epochs}\u0026#39;)\n    pbar = tf.keras.utils.Progbar(target=n_batches)\n    for idx, batch in enumerate(dataloader):\n        train_loss = train_step(batch)\n        pbar.update(idx, values=[(\u0026quot;loss\u0026quot;,train_loss)])\n    val_loss = validate()\n    pbar.update(n_batches, values=[(\u0026#39;val_loss\u0026#39;, val_loss)])\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOutput:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-text\"\u003eEpoch 1/3\n10/10 [==============================] - 2s 225ms/step - loss: 0.4698 - val_loss: 0.9111\nEpoch 2/3\n10/10 [==============================] - 2s 226ms/step - loss: 0.4626 - val_loss: 0.8433\nEpoch 3/3\n10/10 [==============================] - 2s 225ms/step - loss: 0.5835 - val_loss: 0.4997\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNotes:  \u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe metrics shown along with the progress bar are being averaged over each update.\u003cbr\u003eSo if the loss values for each batch over an epoch were [5,4,3,2,1], you would see the values [5, 4.5, 4, 3.5, 3] as the progress bar fills up.\nIf you need the raw values, you need to add an argument to the instantiation of the progress bar.\ne.g.\u003cpre\u003e\u003ccode class=\"language-python\"\u003epbar = tf.keras.utils.Progbar(target=n_batches, stateful_metrics=[\u0026#39;loss\u0026#39;])\n\u003c/code\u003e\u003c/pre\u003e\nThis would make the progress bar not average the values corresponding to the key \u003ccode\u003eloss\u003c/code\u003e during each update.\u003c/li\u003e\n\u003cli\u003eIt\u0026#39;s important to \u0026quot;finish\u0026quot; the progress bar by having the final \u003ccode\u003eupdate\u003c/code\u003e function contain the first argument as \nthe \u003ccode\u003etarget\u003c/code\u003e or total number of iterations set in the progress bar. e.g. The total in the progress bar was the number of batches or \u003ccode\u003en_batches\u003c/code\u003e.\nSo, if you were skipping the validation step, you would still need to call \u003cpre\u003e\u003ccode class=\"language-python\"\u003epbar.update(n_batches, values=None)\n\u003c/code\u003e\u003c/pre\u003e\nafter all the training batches were processed, to finish the progress bar. And it would only show the training loss this time.\u003cbr\u003eFailing to do so will result in incomplete progress bars for each iterations that look like this.\u003cpre\u003e\u003ccode class=\"language-text\"\u003eEpoch 1/3\n9/10 [==========================\u0026gt;...] - ETA: 0s - loss: 0.4153Epoch 2/3\n9/10 [==========================\u0026gt;...] - ETA: 0s - loss: 0.4637Epoch 3/3\n9/10 [==========================\u0026gt;...] - ETA: 0s - loss: 0.5152\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"div\",null,{\"className\":\"mb-7 font-light\",\"children\":[\"↖ \",[\"$\",\"a\",null,{\"rel\":\"\",\"target\":\"\",\"className\":\" text-neutral-200 underline underline-offset-2 transition-all duration-200 decoration-neutral-600 hover:decoration-neutral-400\",\"href\":\"/blog\",\"children\":\"Back\"}]]}],[\"$\",\"article\",null,{\"className\":\"__className_bfc3c1 leading-7 antialiased\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"Short Post\"}],[\"$\",\"p\",null,{\"className\":\"text-neutral-500\",\"children\":\"27 October 2020\"}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$d\"}}]]}]]\n"])</script></body></html>