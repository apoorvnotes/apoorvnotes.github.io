(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const n of c.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function d(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(o){if(o.ep)return;o.ep=!0;const c=d(o);fetch(o.href,c)}})();let i,b,P=!1,E=!1,N=!1,Z=0,Y=100,R=[],k={start:null,end:null},s={active:!1,x:0,y:0,w:0,h:0,startTime:0,endTime:0,duration:.5,level:1,centerX:50,centerY:50},ge=!1,D={x:0,y:0},T={x:50,y:50,w:200,h:150,startTime:0,endTime:0},ue,Fe=[],he=!1,se=!1,Pe=!1,Ie={x:0,y:0},h=[],$e=1,I=null,Ee=!1,g=896,p=504,de=1280,re=720,Be=de/re,U=1,_="contain",Q=null,S=0,z=0,xe=!1,F,ee,w=null,H=null,j=null,Se=0,ze=0,ve=0,Ve=0;const Bt=60,xt=1e3/Bt;function Tt(){F=document.createElement("canvas"),F.width=g,F.height=p,ee=F.getContext("2d",{alpha:!1}),ee.imageSmoothingEnabled=!0,ee.imageSmoothingQuality="high",Lt();const e=document.getElementById("sketch-holder");e.innerHTML="",e.appendChild(F),i=document.createElement("video"),i.style.display="none",document.body.appendChild(i),b=document.createElement("video"),b.style.display="none",document.body.appendChild(b),wt(),F.addEventListener("mousedown",kt),F.addEventListener("mousemove",Ft),F.addEventListener("mouseup",St),Ct(),Re(_),_t(),nt(),Nt()}function Lt(){try{window.OffscreenCanvas?H=new OffscreenCanvas(g,p):(H=document.createElement("canvas"),H.width=g,H.height=p),j=H.getContext("2d",{alpha:!1}),j.imageSmoothingEnabled=!0,j.imageSmoothingQuality="high"}catch(e){console.error("Failed to initialize offscreen canvas:",e),H=null,j=null}}function Ct(){const e=document.createElement("div");e.id="fpsCounter",e.style.position="absolute",e.style.top="10px",e.style.right="10px",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.color="white",e.style.padding="5px",e.style.borderRadius="3px",e.style.fontSize="12px",e.style.fontFamily="monospace",e.style.display="none",e.textContent="FPS: 0";const t=document.getElementById("sketch-holder");t&&(t.style.position="relative",t.appendChild(e)),F.addEventListener("dblclick",bt)}function bt(){const e=document.getElementById("fpsCounter");e&&(e.style.display=e.style.display==="none"?"block":"none")}function $(e){if(!E)return;if(e){if(Se++,e-ze>=1e3){ve=Math.round(Se*1e3/(e-ze)),Se=0,ze=e;const o=document.getElementById("fpsCounter");o&&(o.textContent=`FPS: ${ve}`,o.style.backgroundColor=ve>=55?"rgba(0, 128, 0, 0.7)":ve>=30?"rgba(255, 165, 0, 0.7)":"rgba(255, 0, 0, 0.7)")}if(e-Ve<xt){w=requestAnimationFrame($);return}Ve=e}const t=j||ee;t.fillStyle="black",t.fillRect(0,0,g,p);const d=i.currentTime,a=h.find(o=>o.type==="Zoom"&&d>=o.startTime&&d<=o.endTime);if(a){let o;d<=a.startTime+a.data.duration?o=(d-a.startTime)/a.data.duration:d>=a.endTime-a.data.duration?o=1-(d-(a.endTime-a.data.duration))/a.data.duration:o=1,o=et(o);const c=1+(a.data.level-1)*o,n=50+(a.data.centerX-50)*o,r=50+(a.data.centerY-50)*o,l=i.videoWidth/c,y=i.videoHeight/c,L=n/100*i.videoWidth,m=r/100*i.videoHeight,f=L-l/2,B=m-y/2,u=i.videoWidth/i.videoHeight,x=g/p;let O=g,V=p,q=0,A=0;_==="contain"?u>x?(V=g/u,A=(p-V)/2):(O=p*u,q=(g-O)/2):_==="cover"&&(u>x?(V=p,O=p*u,q=(g-O)/2):(O=g,V=g/u,A=(p-V)/2)),t.fillStyle="black",t.fillRect(0,0,g,p),t.drawImage(i,f,B,l,y,q,A,O,V)}else it(i,0,0,g,p,t);if(P&&i.currentTime>=Y&&(i.currentTime=Z),P){for(let o of R)if(i.currentTime>=o.start&&i.currentTime<o.end){i.currentTime=o.end;break}}if(N&&i.currentTime>=T.startTime&&i.currentTime<=T.endTime){const o=T.x*U,c=T.y*U,n=T.w*U,r=T.h*U;t.drawImage(b,o,c,n,r)}if(ge&&xe&&(t.strokeStyle="red",t.lineWidth=2,t.strokeRect(D.x,D.y,S-D.x,z-D.y)),se&&I!==null){const o=h.find(c=>c.id===I);if(o&&o.type==="Zoom"){const c=o.data.level,n=g/c,r=p/c,l=o.data.centerX/100*g,y=o.data.centerY/100*p,L=l-n/2,m=y-r/2;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,g,m),t.fillRect(0,m+r,g,p-(m+r)),t.fillRect(0,m,L,r),t.fillRect(L+n,m,g-(L+n),r),t.strokeStyle="red",t.lineWidth=2,t.strokeRect(L,m,n,r);const f=10;t.beginPath(),t.moveTo(l-f,y),t.lineTo(l+f,y),t.moveTo(l,y-f),t.lineTo(l,y+f),t.stroke()}}j&&(ee.clearRect(0,0,g,p),ee.drawImage(H,0,0)),Xe(),(P&&!i.paused||se||ce)&&(w=requestAnimationFrame($))}function wt(){document.getElementById("videoInput").addEventListener("change",function(n){const r=n.target.files[0];r&&(i.setAttribute("src",URL.createObjectURL(r)),i.setAttribute("data-filename",r.name),i.onloadedmetadata=()=>{E=!0,i.volume=0,document.getElementById("trimEnd").value=100,Y=i.duration,document.getElementById("trimEndValue").textContent=Y.toFixed(1),Ke(),Xe(),$()})}),document.getElementById("overlayInput").addEventListener("change",function(n){const r=n.target.files[0];r&&(b.setAttribute("src",URL.createObjectURL(r)),b.onloadedmetadata=()=>{N=!0,b.volume=0})}),document.getElementById("playPauseBtn").addEventListener("click",()=>{E&&(P?(i.pause(),N&&b.pause(),P=!1,document.getElementById("playIcon").classList.remove("hidden"),document.getElementById("pauseIcon").classList.add("hidden"),cancelAnimationFrame(w)):(i.play(),N&&b.play(),P=!0,document.getElementById("playIcon").classList.add("hidden"),document.getElementById("pauseIcon").classList.remove("hidden"),$()))}),document.getElementById("resetBtn").addEventListener("click",()=>{E&&(i.currentTime=Z,N&&(b.currentTime=0),P=!1,document.getElementById("playIcon").classList.remove("hidden"),document.getElementById("pauseIcon").classList.add("hidden"))}),document.getElementById("trimStart").addEventListener("input",function(){if(E){const n=parseFloat(this.value);Z=ie(n,0,100,0,i.duration),document.getElementById("trimStartValue").textContent=Z.toFixed(1),i.currentTime=Z}}),document.getElementById("trimEnd").addEventListener("input",function(){if(E){const n=parseFloat(this.value);Y=ie(n,0,100,0,i.duration),document.getElementById("trimEndValue").textContent=Y.toFixed(1)}}),document.getElementById("markCutStart").addEventListener("click",()=>{E&&(k.start=i.currentTime,alert(`Cut start marked at ${k.start.toFixed(2)}s`))}),document.getElementById("markCutEnd").addEventListener("click",()=>{E&&k.start!==null?(k.end=i.currentTime,k.end>k.start?alert(`Cut end marked at ${k.end.toFixed(2)}s`):(alert("End time must be after start time"),k.end=null)):alert("Please mark cut start first")}),document.getElementById("addCut").addEventListener("click",()=>{k.start!==null&&k.end!==null?(R.push({start:k.start,end:k.end}),tt("Cut",k.start,k.end),fe(),k={start:null,end:null}):alert("Please mark both start and end points")}),document.getElementById("clearCuts").addEventListener("click",()=>{R=[],h=h.filter(n=>n.type!=="Cut"),fe(),M()}),document.getElementById("setZoomRegion").addEventListener("click",()=>{ge=!0,alert("Click and drag on the video to set zoom region")}),document.getElementById("clearZoom").addEventListener("click",()=>{s.active=!1,h=h.filter(n=>n.type!=="Zoom"),M()}),document.getElementById("markZoomStart").addEventListener("click",()=>{if(E){const n=i.currentTime;s.startTime=n;const r=ie(n,0,i.duration,0,100);document.getElementById("zoomStartTime").value=r,document.getElementById("zoomStartValue").textContent=n.toFixed(1)}}),document.getElementById("markZoomEnd").addEventListener("click",()=>{if(E){const n=i.currentTime;if(n<=s.startTime){alert("End time must be after start time");return}s.endTime=n;const r=ie(n,0,i.duration,0,100);document.getElementById("zoomEndTime").value=r,document.getElementById("zoomEndValue").textContent=n.toFixed(1)}}),document.getElementById("zoomStartTime").addEventListener("input",function(){if(E){const n=parseFloat(this.value);s.startTime=n,document.getElementById("zoomStartValue").textContent=s.startTime.toFixed(1)}}),document.getElementById("zoomEndTime").addEventListener("input",function(){if(E){const n=parseFloat(this.value);s.endTime=n,document.getElementById("zoomEndValue").textContent=s.endTime.toFixed(1)}}),document.getElementById("overlayStartTime").addEventListener("input",function(){if(E){const n=parseFloat(this.value);T.startTime=ie(n,0,100,0,i.duration),document.getElementById("overlayStartValue").textContent=T.startTime.toFixed(1)}}),document.getElementById("overlayEndTime").addEventListener("input",function(){if(E){const n=parseFloat(this.value);T.endTime=ie(n,0,100,0,i.duration),document.getElementById("overlayEndValue").textContent=T.endTime.toFixed(1)}}),document.getElementById("overlayX").addEventListener("input",function(){T.x=parseInt(this.value),document.getElementById("overlayXValue").textContent=T.x}),document.getElementById("overlayY").addEventListener("input",function(){T.y=parseInt(this.value),document.getElementById("overlayYValue").textContent=T.y}),document.getElementById("overlayWidth").addEventListener("input",function(){T.w=parseInt(this.value),document.getElementById("overlayWidthValue").textContent=T.w}),document.getElementById("overlayHeight").addEventListener("input",function(){T.h=parseInt(this.value),document.getElementById("overlayHeightValue").textContent=T.h});const e=document.getElementById("exportOptionsBtn"),t=document.getElementById("exportOptionsPopup");e.addEventListener("click",n=>{n.stopPropagation(),t.classList.toggle("hidden"),resolutionPopup.classList.add("hidden")}),document.addEventListener("click",n=>{!t.contains(n.target)&&n.target!==e&&t.classList.add("hidden")}),document.getElementById("fitContain").addEventListener("click",()=>{Re("contain")}),document.getElementById("fitCover").addEventListener("click",()=>{Re("cover")}),Zt(),document.getElementById("addZoomBtn").addEventListener("click",At),document.getElementById("addCutBtn").addEventListener("click",Dt),["zoomStartTime","zoomEndTime","zoomLevel","zoomCenterX","zoomCenterY","zoomDuration"].forEach(n=>{document.getElementById(n).addEventListener("input",function(){if(I===null)return;const r=h.find(y=>y.id===I);if(!r||r.type!=="Zoom")return;const l=parseFloat(this.value);switch(n){case"zoomStartTime":r.startTime=l,s.startTime=l;break;case"zoomEndTime":r.endTime=l,s.endTime=l;break;case"zoomLevel":r.data.level=l,s.level=l;break;case"zoomCenterX":r.data.centerX=l,s.centerX=l;break;case"zoomCenterY":r.data.centerY=l,s.centerY=l;break;case"zoomDuration":r.data.duration=l,s.duration=l;break}ae(),M()})}),document.getElementById("cutStartTime").addEventListener("input",function(){if(I===null)return;const n=h.find(l=>l.id===I);if(!n||n.type!=="Cut")return;n.startTime=parseFloat(this.value);const r=R.findIndex(l=>l.id===n.id);r!==-1?R[r].start=n.startTime:R.push({id:n.id,start:n.startTime,end:n.endTime}),fe(),M()}),document.getElementById("cutEndTime").addEventListener("input",function(){if(I===null)return;const n=h.find(l=>l.id===I);if(!n||n.type!=="Cut")return;n.endTime=parseFloat(this.value);const r=R.findIndex(l=>l.id===n.id);r!==-1?R[r].end=n.endTime:R.push({id:n.id,start:n.startTime,end:n.endTime}),fe(),M()}),document.getElementById("importVideoBtn").addEventListener("click",()=>{document.getElementById("videoInput").click()}),document.getElementById("exportVideoBtn").addEventListener("click",async()=>{if(!E){alert("Please load a video first");return}if(Ee)return;Ee=!0;const n=document.getElementById("exportVideoBtn"),r=document.getElementById("exportSpinner"),l=document.getElementById("exportBtnText");if(n.disabled=!0,n.style.setProperty("--progress-width","0%"),n.classList.add("exporting"),!document.getElementById("exportBtnProgressStyle")){const f=document.createElement("style");f.id="exportBtnProgressStyle",f.textContent=`
                .exporting {
                    position: relative;
                    overflow: hidden;
                }
                .exporting::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    height: 100%;
                    width: var(--progress-width, 0%);
                    background-color: rgba(75, 85, 99, 0.5);
                    border-radius: inherit;
                    z-index: 0;
                    transition: width 0.3s ease;
                }
                .exporting span {
                    position: relative;
                    z-index: 1;
                }
            `,document.head.appendChild(f)}r.classList.add("hidden"),l.textContent="Exporting...";const y=document.getElementById("exportProgress"),L=document.getElementById("exportProgressBar"),m=document.getElementById("exportStatus");y.classList.remove("hidden"),L.style.width="0%",m.textContent="Preparing...",document.getElementById("exportOptionsPopup").classList.remove("hidden");try{if(!Q){const{createFFmpeg:v,fetchFile:W}=FFmpeg;Q=v({log:!0}),await Q.load(),m.textContent="FFmpeg loaded"}const f=document.getElementById("exportResolution"),B=document.getElementById("exportFormat");let u,x;const O=f.value,V=B.value;if(O==="original")u=i.videoWidth,x=i.videoHeight;else{const v=O.split("x");u=parseInt(v[0]),x=parseInt(v[1])}const q=document.createElement("canvas");q.width=u,q.height=x;const A=q.getContext("2d");i.currentTime=Z,N&&(b.currentTime=0);const dt=[...R].sort((v,W)=>v.start-W.start);let G=[],le=Z;for(const v of dt){if(v.end<=Z||v.start>=Y)continue;const W=Math.max(v.start,Z),Ce=Math.min(v.end,Y);W>le&&G.push({start:le,end:W}),le=Ce}if(le<Y&&G.push({start:le,end:Y}),G.length===0){alert("No content to export after applying all cuts"),Ee=!1,r.classList.add("hidden"),l.textContent="Export",y.classList.add("hidden");return}m.textContent="Processing video frames...";const pe=30,rt=G.reduce((v,W)=>v+(W.end-W.start),0),at=Math.ceil(rt*pe);let ye=0;for(let v=0;v<G.length;v++){const W=G[v],Ce=W.end-W.start,ut=Math.ceil(Ce*pe);m.textContent=`Processing segment ${v+1}/${G.length}...`;for(let be=0;be<ut;be++){const K=W.start+be/pe;i.currentTime=K,await new Promise(C=>{const me=()=>{i.removeEventListener("seeked",me),C()};i.addEventListener("seeked",me)}),A.fillStyle="black",A.fillRect(0,0,u,x);const X=h.find(C=>C.type==="Zoom"&&K>=C.startTime&&K<=C.endTime);if(X){let C;K<=X.startTime+X.data.duration?C=(K-X.startTime)/X.data.duration:K>=X.endTime-X.data.duration?C=1-(K-(X.endTime-X.data.duration))/X.data.duration:C=1,C=et(C);const me=1+(X.data.level-1)*C,pt=50+(X.data.centerX-50)*C,yt=50+(X.data.centerY-50)*C,We=i.videoWidth/me,Ze=i.videoHeight/me,Et=pt/100*i.videoWidth,vt=yt/100*i.videoHeight,ht=Et-We/2,It=vt-Ze/2,te=i.videoWidth/i.videoHeight,Oe=u/x;let ne=u,oe=x,we=0,ke=0;_==="contain"?te>Oe?(oe=u/te,ke=(x-oe)/2):(ne=x*te,we=(u-ne)/2):_==="cover"&&(te>Oe?(oe=x,ne=x*te,we=(u-ne)/2):(ne=u,oe=u/te,ke=(x-oe)/2)),A.fillStyle="black",A.fillRect(0,0,u,x),A.drawImage(i,ht,It,We,Ze,we,ke,ne,oe)}else it(i,0,0,u,x,A);const ft=q.toDataURL("image/jpeg",.95),gt=await fetch(ft).then(C=>C.arrayBuffer());Q.FS("writeFile",`frame${ye.toString().padStart(6,"0")}.jpg`,new Uint8Array(gt)),ye++;const Me=ye/at*50;L.style.width=`${Me}%`,n.style.setProperty("--progress-width",`${Me}%`)}}m.textContent="Encoding video...";const Te=`output.${V}`,st=V==="mp4"?"libx264":"libvpx";await Q.run("-framerate",pe.toString(),"-i","frame%06d.jpg","-c:v",st,"-pix_fmt","yuv420p",Te),L.style.width="75%",n.style.setProperty("--progress-width","75%"),m.textContent="Finalizing export...";const ct=Q.FS("readFile",Te),lt=new Blob([ct.buffer],{type:`video/${V}`}),He=URL.createObjectURL(lt),Le=document.createElement("a");Le.href=He;const mt=(i.getAttribute("data-filename")||"edited-video").replace(/\.[^/.]+$/,"")+`-edited-${u}x${x}.${V}`;Le.download=mt,Le.click(),URL.revokeObjectURL(He);for(let v=0;v<ye;v++)Q.FS("unlink",`frame${v.toString().padStart(6,"0")}.jpg`);Q.FS("unlink",Te),L.style.width="100%",n.style.setProperty("--progress-width","100%"),m.textContent="Export complete!",setTimeout(()=>{L.style.width="0%",y.classList.add("hidden"),m.textContent="",n.classList.remove("exporting"),n.style.removeProperty("--progress-width")},3e3)}catch(f){console.error("Export error:",f),alert("Error during export: "+f.message),m.textContent=`Export failed: ${f.message}`,n.classList.remove("exporting"),n.style.removeProperty("--progress-width")}finally{Ee=!1,n.disabled=!1,l.textContent="Export"}}),document.getElementById("videoInput").addEventListener("change",function(n){n.target.files.length>0&&(document.getElementById("importVideoBtn").textContent="Change Video")}),document.getElementById("resolutionMenuBtn").addEventListener("click",function(n){document.getElementById("resolutionPopup").classList.toggle("hidden"),n.stopPropagation()}),document.addEventListener("click",function(n){const r=document.getElementById("resolutionPopup"),l=document.getElementById("resolutionMenuBtn");!r.contains(n.target)&&n.target!==l&&r.classList.add("hidden")}),document.getElementById("res720p").addEventListener("click",()=>J(1280,720)),document.getElementById("res1080p").addEventListener("click",()=>J(1920,1080)),document.getElementById("res1440p").addEventListener("click",()=>J(2560,1440)),document.getElementById("res4k").addEventListener("click",()=>J(3840,2160)),document.getElementById("resMobile720p").addEventListener("click",()=>J(720,1280)),document.getElementById("resMobile1080p").addEventListener("click",()=>J(1080,1920)),document.getElementById("resMobileStory").addEventListener("click",()=>J(1080,1920)),document.getElementById("applyCustomRes").addEventListener("click",Qt),document.getElementById("maintainAspectRatio").addEventListener("change",function(){const n=document.getElementById("customWidth"),r=document.getElementById("customHeight");if(this.checked){const l=parseInt(n.value),y=parseInt(r.value);!isNaN(l)&&!isNaN(y)&&(Be=l/y),n.addEventListener("input",Ue),r.addEventListener("input",je)}else n.removeEventListener("input",Ue),r.removeEventListener("input",je)}),$t();const o=document.getElementById("startRecording");o&&o.addEventListener("click",Mt);const c=document.getElementById("stopRecording");c&&c.addEventListener("click",Wt)}function kt(e){const t=F.getBoundingClientRect();S=e.clientX-t.left,z=e.clientY-t.top,xe=!0,zt()}function Ft(e){const t=F.getBoundingClientRect();S=e.clientX-t.left,z=e.clientY-t.top,xe&&(Rt(),w||$())}function St(e){const t=F.getBoundingClientRect();S=e.clientX-t.left,z=e.clientY-t.top,xe=!1,Pt()}function zt(){if(ge&&S>=0&&S<=g&&z>=0&&z<=p)D.x=S,D.y=z;else if(se&&E&&I!==null){const e=h.find(t=>t.id===I);if(e&&e.type==="Zoom"){const t=e.data.level,d=g/t,a=p/t,o=e.data.centerX/100*g,c=e.data.centerY/100*p,n=o-d/2,r=c-a/2;S>=n&&S<=n+d&&z>=r&&z<=r+a&&(Pe=!0,Ie.x=S-o,Ie.y=z-c)}}}function Rt(){if(Pe&&I!==null){const e=h.find(l=>l.id===I);if(!e||e.type!=="Zoom")return;let t=S-Ie.x,d=z-Ie.y;const a=e.data.level,o=g/a,c=p/a;t=Qe(t,o/2,g-o/2),d=Qe(d,c/2,p-c/2);const n=t/g*100,r=d/p*100;document.getElementById("zoomCenterX").value=n,document.getElementById("zoomCenterY").value=r,e.data.centerX=n,e.data.centerY=r,s.centerX=n,s.centerY=r,ae(),w||$()}}function Pt(){if(ge&&S>=0&&S<=g&&z>=0&&z<=p){const e=_e(D.x,S),t=_e(D.y,z),d=Ge(D.x,S),a=Ge(D.y,z),o=De(e,t),c=De(d-e,a-t);s.x=o.x,s.y=o.y,s.w=c.x,s.h=c.y,s.active=!0,ge=!1}Pe=!1}function Ke(){E&&(i.duration,document.getElementById("zoomStartTime").max=100,document.getElementById("zoomEndTime").max=100,document.getElementById("overlayStartTime").max=100,document.getElementById("overlayEndTime").max=100)}function fe(){const e=document.getElementById("cutsList");e.innerHTML="",R.forEach((t,d)=>{const a=document.createElement("div");a.textContent=`Cut ${d+1}: ${t.start.toFixed(2)}s - ${t.end.toFixed(2)}s`,e.appendChild(a)})}function Xe(){const e=document.getElementById("timeline"),t=document.getElementById("current-time-display"),d=document.getElementById("time-indicator"),a=document.getElementById("time-handle"),o=document.getElementById("timeline-progress");if(!E||!e||!t)return;const c=i.duration,n=i.currentTime;t.innerHTML=`<span style="color: var(--color-text-highlight); font-family: monospace">${qe(n)}</span> / <span style="color: var(--color-text); font-family: monospace">${qe(c)}</span>`;const r=n/c,l=r*e.offsetWidth;o&&(o.style.width=`${r*100}%`),d&&(d.style.left=`${l}px`),a&&(a.style.left=`${l}px`),R.forEach((m,f)=>{const B=`cut-${f}`;let u=document.getElementById(B);u||(u=document.createElement("div"),u.id=B,u.className="cut-indicator",e.appendChild(u));const x=m.start/c*100,O=(m.end-m.start)/c*100;u.style.left=`${x}%`,u.style.width=`${O}%`});const y=h.filter(m=>m.type==="Zoom");document.querySelectorAll(".zoom-indicator").forEach(m=>{const f=m.id,B=f?parseInt(f.replace("zoom-","")):null;(!B||!y.find(u=>u.id===B))&&m.remove()}),y.forEach(m=>{const f=`zoom-${m.id}`;let B=document.getElementById(f);B||(B=document.createElement("div"),B.id=f,B.className="zoom-indicator",e.appendChild(B));const u=m.startTime/c*100,x=(m.endTime-m.startTime)/c*100;B.style.left=`${u}%`,B.style.width=`${x}%`})}let ce=!1,Je=!1;function $t(){const e=document.getElementById("timeline"),t=document.getElementById("time-handle");e&&(e.addEventListener("mousedown",Ne),document.addEventListener("mousemove",Xt),document.addEventListener("mouseup",Yt),t&&t.addEventListener("mousedown",d=>{d.stopPropagation(),Ne(d)}),e.addEventListener("click",Ht))}function Ne(e){E&&(ce=!0,Je=P,P&&(i.pause(),N&&b.pause()),Ye(e),w||(w=requestAnimationFrame($)))}function Xt(e){ce&&Ye(e)}function Yt(e){ce&&(ce=!1,Je?(i.play(),N&&b.play(),P=!0,document.getElementById("playIcon").classList.add("hidden"),document.getElementById("pauseIcon").classList.remove("hidden")):w&&!P&&!se&&(cancelAnimationFrame(w),w=null))}function Ht(e){!E||ce||Ye(e)}function Ye(e){const d=document.getElementById("timeline").getBoundingClientRect(),c=(e.clientX-d.left)/d.width*i.duration,n=Math.max(0,Math.min(c,i.duration));i.currentTime=n;for(let r of R)if(n>=r.start&&n<r.end){i.currentTime=r.end;break}n<Z?i.currentTime=Z:n>Y&&(i.currentTime=Y),$()}function Mt(){if(!E){alert("Please load a video first");return}if(he){alert("Already recording");return}i.currentTime=Z,N&&(b.currentTime=0);const e=document.querySelector("canvas").captureStream();ue=new MediaRecorder(e),Fe=[],ue.ondataavailable=t=>Fe.push(t.data),ue.onstop=()=>{const t=new Blob(Fe,{type:"video/webm"}),d=URL.createObjectURL(t),a=document.createElement("a");a.href=d,a.download="edited-video.webm",a.click(),URL.revokeObjectURL(d)},ue.start(),i.play(),N&&b.play(),P=!0,he=!0,document.getElementById("playIcon").classList.add("hidden"),document.getElementById("pauseIcon").classList.remove("hidden"),alert("Recording started. Press 'Stop Recording' when finished.")}function Wt(){if(!he){alert("Not currently recording");return}ue.stop(),i.pause(),N&&b.pause(),P=!1,he=!1,document.getElementById("playIcon").classList.remove("hidden"),document.getElementById("pauseIcon").classList.add("hidden"),alert("Recording stopped. Download will start automatically.")}function Zt(){document.getElementById("zoomDuration").addEventListener("input",function(){const e=parseFloat(this.value);if(I!==null){const t=h.find(d=>d.id===I);t&&t.type==="Zoom"&&(t.data.duration=e,s.duration=e,M())}}),document.getElementById("zoomLevel").addEventListener("input",function(){const e=parseFloat(this.value);if(I!==null){const t=h.find(d=>d.id===I);t&&t.type==="Zoom"&&(t.data.level=e,s.level=e,ae(),M())}}),document.getElementById("zoomCenterX").addEventListener("input",function(){const e=parseFloat(this.value);if(I!==null){const t=h.find(d=>d.id===I);t&&t.type==="Zoom"&&(t.data.centerX=e,s.centerX=e,ae(),M())}}),document.getElementById("zoomCenterY").addEventListener("input",function(){const e=parseFloat(this.value);if(I!==null){const t=h.find(d=>d.id===I);t&&t.type==="Zoom"&&(t.data.centerY=e,s.centerY=e,ae(),M())}}),document.getElementById("showZoomRegion").addEventListener("change",function(){se=this.checked,se?w||$():!P&&w&&(cancelAnimationFrame(w),w=null),$()})}function ae(){if(!E)return;const e=s.level,t=g/e,d=p/e,a=s.centerX/100*g,o=s.centerY/100*p;s.x=a-t/2,s.y=o-d/2,s.w=t,s.h=d,s.active=!0;const c=h.find(n=>n.type==="Zoom");c?(c.startTime=s.startTime,c.endTime=s.endTime,c.data={level:s.level,centerX:s.centerX,centerY:s.centerY,duration:s.duration}):tt("Zoom",s.startTime,s.endTime,{level:s.level,centerX:s.centerX,centerY:s.centerY,duration:s.duration}),M()}function et(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}function Ae(e){const t=Math.floor(e/60),d=(e%60).toFixed(1);return`${t}:${d.padStart(4,"0")}`}function M(){const e=document.getElementById("editsTable");e.innerHTML="",h.forEach(t=>{const d=document.createElement("tr");d.className="border-b border-text/10",d.innerHTML=`
            <td class="py-2 px-4">${t.id}</td>
            <td class="py-2 px-4">${t.type}</td>
            <td class="py-2 px-4">${Ae(t.startTime)}</td>
            <td class="py-2 px-4">${Ae(t.endTime)}</td>
            <td class="py-2 px-4">
                <button class="bg-button hover:bg-button/80 text-text py-1 px-2 rounded mr-2 text-xs" 
                        onclick="editEdit(${t.id})">
                    Edit
                </button>
                <button class="bg-red-500/50 hover:bg-red-500/70 text-text py-1 px-2 rounded text-xs" 
                        onclick="deleteEdit(${t.id})">
                    Delete
                </button>
            </td>
        `,e.appendChild(d)})}function tt(e,t,d,a={}){const o={id:$e++,type:e,startTime:t,endTime:d,...a};h.push(o),M()}function Ot(){document.getElementById("zoomConfig").classList.remove("hidden"),document.getElementById("cutConfig").classList.add("hidden"),document.getElementById("noEditMessage").classList.add("hidden")}function Vt(){document.getElementById("zoomConfig").classList.add("hidden"),document.getElementById("cutConfig").classList.remove("hidden"),document.getElementById("noEditMessage").classList.add("hidden")}function Nt(){document.getElementById("zoomConfig").classList.add("hidden"),document.getElementById("cutConfig").classList.add("hidden"),document.getElementById("noEditMessage").classList.remove("hidden")}function At(){const e=i.currentTime,t={id:$e++,type:"Zoom",startTime:e,endTime:e+2,data:{level:2,centerX:50,centerY:50,duration:.5}};h.push(t),I=t.id,s.startTime=t.startTime,s.endTime=t.endTime,s.level=t.data.level,s.centerX=t.data.centerX,s.centerY=t.data.centerY,s.duration=t.data.duration,s.active=!0,Ot(),Ut(t),ae(),M()}function Dt(){const e=i.currentTime,t={id:$e++,type:"Cut",startTime:e,endTime:e+1};h.push(t),I=t.id,R.push({id:t.id,start:t.startTime,end:t.endTime}),Vt(),jt(t),fe(),M()}function Ut(e){document.getElementById("zoomStartTime").value=e.startTime,document.getElementById("zoomEndTime").value=e.endTime,document.getElementById("zoomLevel").value=e.data.level,document.getElementById("zoomCenterX").value=e.data.centerX,document.getElementById("zoomCenterY").value=e.data.centerY,document.getElementById("zoomDuration").value=e.data.duration,w||$()}function jt(e){document.getElementById("cutStartTime").value=e.startTime,document.getElementById("cutEndTime").value=e.endTime}function nt(){const e=g/de,t=p/re;U=Math.min(e,t),g=Math.floor(de*U),p=Math.floor(re*U),qt(g,p)}function qt(e,t){F&&(F.width=e,F.height=t,H&&(window.OffscreenCanvas&&H instanceof OffscreenCanvas?H=new OffscreenCanvas(e,t):(H.width=e,H.height=t),j=H.getContext("2d",{alpha:!1}),j.imageSmoothingEnabled=!0,j.imageSmoothingQuality="high"),w||$())}function ot(e,t){de=e,re=t,Be=de/re,nt(),document.getElementById("currentResolution").textContent=`${de}×${re}`}function De(e,t){return{x:e/U,y:t/U}}function J(e,t){document.getElementById("customWidth").value=e,document.getElementById("customHeight").value=t,ot(e,t)}function Qt(){const e=parseInt(document.getElementById("customWidth").value),t=parseInt(document.getElementById("customHeight").value);if(isNaN(e)||isNaN(t)||e<100||t<100){alert("Please enter valid dimensions (minimum 100x100)");return}(e>7680||t>4320)&&!confirm("Very large resolutions may cause performance issues. Continue?")||ot(e,t)}function Ue(){if(!document.getElementById("maintainAspectRatio").checked)return;const e=parseInt(document.getElementById("customWidth").value);if(!isNaN(e)){const t=Math.round(e/Be);document.getElementById("customHeight").value=t}}function je(){if(!document.getElementById("maintainAspectRatio").checked)return;const e=parseInt(document.getElementById("customHeight").value);if(!isNaN(e)){const t=Math.round(e*Be);document.getElementById("customWidth").value=t}}function it(e,t,d,a,o,c){if(!e)return;const n=c||ee,r=e.videoWidth,l=e.videoHeight,y=r/l,L=a/o;if(n.fillStyle="black",n.fillRect(t,d,a,o),_==="contain"){let m,f;y>L?(m=a,f=a/y):(f=o,m=o*y);const B=(a-m)/2,u=(o-f)/2;n.drawImage(e,t+B,d+u,m,f)}else if(_==="cover"){let m,f;y>L?(f=o,m=o*y):(m=a,f=a/y);const B=(a-m)/2,u=(o-f)/2;n.drawImage(e,t+B,d+u,m,f)}}function Re(e){_=e;const t=document.getElementById("fitContain"),d=document.getElementById("fitCover");e==="contain"?(t.classList.add("active-option"),d.classList.remove("active-option")):e==="cover"&&(d.classList.add("active-option"),t.classList.remove("active-option")),E&&$()}function qe(e){const t=Math.floor(e/3600),d=Math.floor(e%3600/60),a=Math.floor(e%60),o=Math.floor(e%1*1e3);return e>=3600?`${t}:${d.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}.${o.toString().padStart(3,"0")}`:`${d}:${a.toString().padStart(2,"0")}.${o.toString().padStart(3,"0")}`}function Qe(e,t,d){return Math.max(t,Math.min(d,e))}function _e(e,t){return Math.min(e,t)}function Ge(e,t){return Math.max(e,t)}function ie(e,t,d,a,o){return a+(o-a)*((e-t)/(d-t))}function _t(){const t=document.getElementById("videoInput").getAttribute("data-default-video");t&&(i.src=t,i.onloadedmetadata=()=>{E=!0,i.volume=0,document.getElementById("trimEnd").value=100,Y=i.duration,document.getElementById("trimEndValue").textContent=Y.toFixed(1),Ke(),Xe(),$()})}window.onload=function(){Tt()};
