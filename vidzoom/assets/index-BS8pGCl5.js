(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const n of c.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function r(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(o){if(o.ep)return;o.ep=!0;const c=r(o);fetch(o.href,c)}})();let i,C,R=!1,y=!1,O=!1,Z=0,$=100,z=[],w={start:null,end:null},s={active:!1,x:0,y:0,w:0,h:0,startTime:0,endTime:0,duration:.5,level:1,centerX:50,centerY:50},re=!1,V={x:0,y:0},x={x:50,y:50,w:200,h:150,startTime:0,endTime:0},ie,Le=[],pe=!1,ee=!1,ke=!1,ye={x:0,y:0},h=[],Fe=1,v=null,fe=!1,g=896,I=504,G=1280,K=720,he=G/K,N=1,Ee="contain",D=null,F=0,S=0,ve=!1,k,Q,b=null,X=null,A=null,Ce=0,be=0,ge=0,Ye=0;const pt=60,yt=1e3/pt;function Et(){k=document.createElement("canvas"),k.width=g,k.height=I,Q=k.getContext("2d",{alpha:!1}),Q.imageSmoothingEnabled=!0,Q.imageSmoothingQuality="high",ht();const e=document.getElementById("sketch-holder");e.innerHTML="",e.appendChild(k),i=document.createElement("video"),i.style.display="none",document.body.appendChild(i),C=document.createElement("video"),C.style.display="none",document.body.appendChild(C),Bt(),k.addEventListener("mousedown",xt),k.addEventListener("mousemove",Tt),k.addEventListener("mouseup",Lt),vt(),we(Ee),At(),_e(),Mt()}function ht(){try{window.OffscreenCanvas?X=new OffscreenCanvas(g,I):(X=document.createElement("canvas"),X.width=g,X.height=I),A=X.getContext("2d",{alpha:!1}),A.imageSmoothingEnabled=!0,A.imageSmoothingQuality="high"}catch(e){console.error("Failed to initialize offscreen canvas:",e),X=null,A=null}}function vt(){const e=document.createElement("div");e.id="fpsCounter",e.style.position="absolute",e.style.top="10px",e.style.right="10px",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.color="white",e.style.padding="5px",e.style.borderRadius="3px",e.style.fontSize="12px",e.style.fontFamily="monospace",e.style.display="none",e.textContent="FPS: 0";const t=document.getElementById("sketch-holder");t&&(t.style.position="relative",t.appendChild(e)),k.addEventListener("dblclick",It)}function It(){const e=document.getElementById("fpsCounter");e&&(e.style.display=e.style.display==="none"?"block":"none")}function M(e){if(!y)return;if(e){if(Ce++,e-be>=1e3){ge=Math.round(Ce*1e3/(e-be)),Ce=0,be=e;const o=document.getElementById("fpsCounter");o&&(o.textContent=`FPS: ${ge}`,o.style.backgroundColor=ge>=55?"rgba(0, 128, 0, 0.7)":ge>=30?"rgba(255, 165, 0, 0.7)":"rgba(255, 0, 0, 0.7)")}if(e-Ye<yt){b=requestAnimationFrame(M);return}Ye=e}const t=A||Q;t.fillStyle="black",t.fillRect(0,0,g,I);const r=i.currentTime,a=h.find(o=>o.type==="Zoom"&&r>=o.startTime&&r<=o.endTime);if(a){let o;r<=a.startTime+a.data.duration?o=(r-a.startTime)/a.data.duration:r>=a.endTime-a.data.duration?o=1-(r-(a.endTime-a.data.duration))/a.data.duration:o=1,o=qe(o);const c=1+(a.data.level-1)*o,n=50+(a.data.centerX-50)*o,d=50+(a.data.centerY-50)*o,l=i.videoWidth/c,f=i.videoHeight/c,T=n/100*i.videoWidth,m=d/100*i.videoHeight,u=T-l/2,B=m-f/2;t.drawImage(i,u,B,l,f,0,0,g,I)}else Ke(i,0,0,g,I,t);if(R&&i.currentTime>=$&&(i.currentTime=Z),R){for(let o of z)if(i.currentTime>=o.start&&i.currentTime<o.end){i.currentTime=o.end;break}}if(O&&i.currentTime>=x.startTime&&i.currentTime<=x.endTime){const o=x.x*N,c=x.y*N,n=x.w*N,d=x.h*N;t.drawImage(C,o,c,n,d)}if(re&&ve&&(t.strokeStyle="red",t.lineWidth=2,t.strokeRect(V.x,V.y,F-V.x,S-V.y)),ee&&v!==null){const o=h.find(c=>c.id===v);if(o&&o.type==="Zoom"){const c=o.data.level,n=g/c,d=I/c,l=o.data.centerX/100*g,f=o.data.centerY/100*I,T=l-n/2,m=f-d/2;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,g,m),t.fillRect(0,m+d,g,I-(m+d)),t.fillRect(0,m,T,d),t.fillRect(T+n,m,g-(T+n),d),t.strokeStyle="red",t.lineWidth=2,t.strokeRect(T,m,n,d);const u=10;t.beginPath(),t.moveTo(l-u,f),t.lineTo(l+u,f),t.moveTo(l,f-u),t.lineTo(l,f+u),t.stroke()}}A&&(Q.clearRect(0,0,g,I),Q.drawImage(X,0,0)),Se(),(R&&!i.paused||ee||te)&&(b=requestAnimationFrame(M))}function Bt(){document.getElementById("videoInput").addEventListener("change",function(n){const d=n.target.files[0];d&&(i.setAttribute("src",URL.createObjectURL(d)),i.setAttribute("data-filename",d.name),i.onloadedmetadata=()=>{y=!0,i.volume=0,document.getElementById("trimEnd").value=100,$=i.duration,document.getElementById("trimEndValue").textContent=$.toFixed(1),Ue(),Se(),M()})}),document.getElementById("overlayInput").addEventListener("change",function(n){const d=n.target.files[0];d&&(C.setAttribute("src",URL.createObjectURL(d)),C.onloadedmetadata=()=>{O=!0,C.volume=0})}),document.getElementById("playPauseBtn").addEventListener("click",()=>{y&&(R?(i.pause(),O&&C.pause(),R=!1,document.getElementById("playIcon").classList.remove("hidden"),document.getElementById("pauseIcon").classList.add("hidden"),cancelAnimationFrame(b)):(i.play(),O&&C.play(),R=!0,document.getElementById("playIcon").classList.add("hidden"),document.getElementById("pauseIcon").classList.remove("hidden"),M()))}),document.getElementById("resetBtn").addEventListener("click",()=>{y&&(i.currentTime=Z,O&&(C.currentTime=0),R=!1,document.getElementById("playIcon").classList.remove("hidden"),document.getElementById("pauseIcon").classList.add("hidden"))}),document.getElementById("trimStart").addEventListener("input",function(){if(y){const n=parseFloat(this.value);Z=_(n,0,100,0,i.duration),document.getElementById("trimStartValue").textContent=Z.toFixed(1),i.currentTime=Z}}),document.getElementById("trimEnd").addEventListener("input",function(){if(y){const n=parseFloat(this.value);$=_(n,0,100,0,i.duration),document.getElementById("trimEndValue").textContent=$.toFixed(1)}}),document.getElementById("markCutStart").addEventListener("click",()=>{y&&(w.start=i.currentTime,alert(`Cut start marked at ${w.start.toFixed(2)}s`))}),document.getElementById("markCutEnd").addEventListener("click",()=>{y&&w.start!==null?(w.end=i.currentTime,w.end>w.start?alert(`Cut end marked at ${w.end.toFixed(2)}s`):(alert("End time must be after start time"),w.end=null)):alert("Please mark cut start first")}),document.getElementById("addCut").addEventListener("click",()=>{w.start!==null&&w.end!==null?(z.push({start:w.start,end:w.end}),Qe("Cut",w.start,w.end),de(),w={start:null,end:null}):alert("Please mark both start and end points")}),document.getElementById("clearCuts").addEventListener("click",()=>{z=[],h=h.filter(n=>n.type!=="Cut"),de(),Y()}),document.getElementById("setZoomRegion").addEventListener("click",()=>{re=!0,alert("Click and drag on the video to set zoom region")}),document.getElementById("clearZoom").addEventListener("click",()=>{s.active=!1,h=h.filter(n=>n.type!=="Zoom"),Y()}),document.getElementById("markZoomStart").addEventListener("click",()=>{if(y){const n=i.currentTime;s.startTime=n;const d=_(n,0,i.duration,0,100);document.getElementById("zoomStartTime").value=d,document.getElementById("zoomStartValue").textContent=n.toFixed(1)}}),document.getElementById("markZoomEnd").addEventListener("click",()=>{if(y){const n=i.currentTime;if(n<=s.startTime){alert("End time must be after start time");return}s.endTime=n;const d=_(n,0,i.duration,0,100);document.getElementById("zoomEndTime").value=d,document.getElementById("zoomEndValue").textContent=n.toFixed(1)}}),document.getElementById("zoomStartTime").addEventListener("input",function(){if(y){const n=parseFloat(this.value);s.startTime=n,document.getElementById("zoomStartValue").textContent=s.startTime.toFixed(1)}}),document.getElementById("zoomEndTime").addEventListener("input",function(){if(y){const n=parseFloat(this.value);s.endTime=n,document.getElementById("zoomEndValue").textContent=s.endTime.toFixed(1)}}),document.getElementById("overlayStartTime").addEventListener("input",function(){if(y){const n=parseFloat(this.value);x.startTime=_(n,0,100,0,i.duration),document.getElementById("overlayStartValue").textContent=x.startTime.toFixed(1)}}),document.getElementById("overlayEndTime").addEventListener("input",function(){if(y){const n=parseFloat(this.value);x.endTime=_(n,0,100,0,i.duration),document.getElementById("overlayEndValue").textContent=x.endTime.toFixed(1)}}),document.getElementById("overlayX").addEventListener("input",function(){x.x=parseInt(this.value),document.getElementById("overlayXValue").textContent=x.x}),document.getElementById("overlayY").addEventListener("input",function(){x.y=parseInt(this.value),document.getElementById("overlayYValue").textContent=x.y}),document.getElementById("overlayWidth").addEventListener("input",function(){x.w=parseInt(this.value),document.getElementById("overlayWidthValue").textContent=x.w}),document.getElementById("overlayHeight").addEventListener("input",function(){x.h=parseInt(this.value),document.getElementById("overlayHeightValue").textContent=x.h});const e=document.getElementById("exportOptionsBtn"),t=document.getElementById("exportOptionsPopup");e.addEventListener("click",n=>{n.stopPropagation(),t.classList.toggle("hidden"),resolutionPopup.classList.add("hidden")}),document.addEventListener("click",n=>{!t.contains(n.target)&&n.target!==e&&t.classList.add("hidden")}),document.getElementById("fitContain").addEventListener("click",()=>{we("contain")}),document.getElementById("fitCover").addEventListener("click",()=>{we("cover")}),$t(),document.getElementById("addZoomBtn").addEventListener("click",Ht),document.getElementById("addCutBtn").addEventListener("click",Zt),["zoomStartTime","zoomEndTime","zoomLevel","zoomCenterX","zoomCenterY","zoomDuration"].forEach(n=>{document.getElementById(n).addEventListener("input",function(){if(v===null)return;const d=h.find(f=>f.id===v);if(!d||d.type!=="Zoom")return;const l=parseFloat(this.value);switch(n){case"zoomStartTime":d.startTime=l,s.startTime=l;break;case"zoomEndTime":d.endTime=l,s.endTime=l;break;case"zoomLevel":d.data.level=l,s.level=l;break;case"zoomCenterX":d.data.centerX=l,s.centerX=l;break;case"zoomCenterY":d.data.centerY=l,s.centerY=l;break;case"zoomDuration":d.data.duration=l,s.duration=l;break}J(),Y()})}),document.getElementById("cutStartTime").addEventListener("input",function(){if(v===null)return;const n=h.find(l=>l.id===v);if(!n||n.type!=="Cut")return;n.startTime=parseFloat(this.value);const d=z.findIndex(l=>l.id===n.id);d!==-1?z[d].start=n.startTime:z.push({id:n.id,start:n.startTime,end:n.endTime}),de(),Y()}),document.getElementById("cutEndTime").addEventListener("input",function(){if(v===null)return;const n=h.find(l=>l.id===v);if(!n||n.type!=="Cut")return;n.endTime=parseFloat(this.value);const d=z.findIndex(l=>l.id===n.id);d!==-1?z[d].end=n.endTime:z.push({id:n.id,start:n.startTime,end:n.endTime}),de(),Y()}),document.getElementById("importVideoBtn").addEventListener("click",()=>{document.getElementById("videoInput").click()}),document.getElementById("exportVideoBtn").addEventListener("click",async()=>{if(!y){alert("Please load a video first");return}if(fe)return;fe=!0;const n=document.getElementById("exportVideoBtn"),d=document.getElementById("exportSpinner"),l=document.getElementById("exportBtnText");if(n.disabled=!0,n.style.setProperty("--progress-width","0%"),n.classList.add("exporting"),!document.getElementById("exportBtnProgressStyle")){const u=document.createElement("style");u.id="exportBtnProgressStyle",u.textContent=`
                .exporting {
                    position: relative;
                    overflow: hidden;
                }
                .exporting::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    height: 100%;
                    width: var(--progress-width, 0%);
                    background-color: rgba(75, 85, 99, 0.5);
                    border-radius: inherit;
                    z-index: 0;
                    transition: width 0.3s ease;
                }
                .exporting span {
                    position: relative;
                    z-index: 1;
                }
            `,document.head.appendChild(u)}d.classList.add("hidden"),l.textContent="Exporting...";const f=document.getElementById("exportProgress"),T=document.getElementById("exportProgressBar"),m=document.getElementById("exportStatus");f.classList.remove("hidden"),T.style.width="0%",m.textContent="Preparing...",document.getElementById("exportOptionsPopup").classList.remove("hidden");try{if(!D){const{createFFmpeg:E,fetchFile:H}=FFmpeg;D=E({log:!0}),await D.load(),m.textContent="FFmpeg loaded"}const u=document.getElementById("exportResolution"),B=document.getElementById("exportFormat");let p,W;const ae=u.value,se=B.value;if(ae==="original")p=i.videoWidth,W=i.videoHeight;else{const E=ae.split("x");p=parseInt(E[0]),W=parseInt(E[1])}const ce=document.createElement("canvas");ce.width=p,ce.height=W;const le=ce.getContext("2d");i.currentTime=Z,O&&(C.currentTime=0);const Je=[...z].sort((E,H)=>E.start-H.start);let U=[],ne=Z;for(const E of Je){if(E.end<=Z||E.start>=$)continue;const H=Math.max(E.start,Z),xe=Math.min(E.end,$);H>ne&&U.push({start:ne,end:H}),ne=xe}if(ne<$&&U.push({start:ne,end:$}),U.length===0){alert("No content to export after applying all cuts"),fe=!1,d.classList.add("hidden"),l.textContent="Export",f.classList.add("hidden");return}m.textContent="Processing video frames...";const me=30,et=U.reduce((E,H)=>E+(H.end-H.start),0),tt=Math.ceil(et*me);let ue=0;for(let E=0;E<U.length;E++){const H=U[E],xe=H.end-H.start,rt=Math.ceil(xe*me);m.textContent=`Processing segment ${E+1}/${U.length}...`;for(let Te=0;Te<rt;Te++){const j=H.start+Te/me;i.currentTime=j,await new Promise(L=>{const oe=()=>{i.removeEventListener("seeked",oe),L()};i.addEventListener("seeked",oe)}),le.fillStyle="black",le.fillRect(0,0,p,W);const P=h.find(L=>L.type==="Zoom"&&j>=L.startTime&&j<=L.endTime);if(P){let L;j<=P.startTime+P.data.duration?L=(j-P.startTime)/P.data.duration:j>=P.endTime-P.data.duration?L=1-(j-(P.endTime-P.data.duration))/P.data.duration:L=1,L=qe(L);const oe=1+(P.data.level-1)*L,ct=50+(P.data.centerX-50)*L,lt=50+(P.data.centerY-50)*L,$e=i.videoWidth/oe,Xe=i.videoHeight/oe,mt=ct/100*i.videoWidth,ut=lt/100*i.videoHeight,ft=mt-$e/2,gt=ut-Xe/2;le.drawImage(i,ft,gt,$e,Xe,0,0,p,W)}else Ke(i,0,0,p,W,le);const at=ce.toDataURL("image/jpeg",.95),st=await fetch(at).then(L=>L.arrayBuffer());D.FS("writeFile",`frame${ue.toString().padStart(6,"0")}.jpg`,new Uint8Array(st)),ue++;const Pe=ue/tt*50;T.style.width=`${Pe}%`,n.style.setProperty("--progress-width",`${Pe}%`)}}m.textContent="Encoding video...";const Ie=`output.${se}`,nt=se==="mp4"?"libx264":"libvpx";await D.run("-framerate",me.toString(),"-i","frame%06d.jpg","-c:v",nt,"-pix_fmt","yuv420p",Ie),T.style.width="75%",n.style.setProperty("--progress-width","75%"),m.textContent="Finalizing export...";const ot=D.FS("readFile",Ie),it=new Blob([ot.buffer],{type:`video/${se}`}),Re=URL.createObjectURL(it),Be=document.createElement("a");Be.href=Re;const dt=(i.getAttribute("data-filename")||"edited-video").replace(/\.[^/.]+$/,"")+`-edited-${p}x${W}.${se}`;Be.download=dt,Be.click(),URL.revokeObjectURL(Re);for(let E=0;E<ue;E++)D.FS("unlink",`frame${E.toString().padStart(6,"0")}.jpg`);D.FS("unlink",Ie),T.style.width="100%",n.style.setProperty("--progress-width","100%"),m.textContent="Export complete!",setTimeout(()=>{T.style.width="0%",f.classList.add("hidden"),m.textContent="",n.classList.remove("exporting"),n.style.removeProperty("--progress-width")},3e3)}catch(u){console.error("Export error:",u),alert("Error during export: "+u.message),m.textContent=`Export failed: ${u.message}`,n.classList.remove("exporting"),n.style.removeProperty("--progress-width")}finally{fe=!1,n.disabled=!1,l.textContent="Export"}}),document.getElementById("videoInput").addEventListener("change",function(n){n.target.files.length>0&&(document.getElementById("importVideoBtn").textContent="Change Video")}),document.getElementById("resolutionMenuBtn").addEventListener("click",function(n){document.getElementById("resolutionPopup").classList.toggle("hidden"),n.stopPropagation()}),document.addEventListener("click",function(n){const d=document.getElementById("resolutionPopup"),l=document.getElementById("resolutionMenuBtn");!d.contains(n.target)&&n.target!==l&&d.classList.add("hidden")}),document.getElementById("res720p").addEventListener("click",()=>q(1280,720)),document.getElementById("res1080p").addEventListener("click",()=>q(1920,1080)),document.getElementById("res1440p").addEventListener("click",()=>q(2560,1440)),document.getElementById("res4k").addEventListener("click",()=>q(3840,2160)),document.getElementById("resMobile720p").addEventListener("click",()=>q(720,1280)),document.getElementById("resMobile1080p").addEventListener("click",()=>q(1080,1920)),document.getElementById("resMobileStory").addEventListener("click",()=>q(1080,1920)),document.getElementById("applyCustomRes").addEventListener("click",Nt),document.getElementById("maintainAspectRatio").addEventListener("change",function(){const n=document.getElementById("customWidth"),d=document.getElementById("customHeight");if(this.checked){const l=parseInt(n.value),f=parseInt(d.value);!isNaN(l)&&!isNaN(f)&&(he=l/f),n.addEventListener("input",We),d.addEventListener("input",Oe)}else n.removeEventListener("input",We),d.removeEventListener("input",Oe)}),kt();const o=document.getElementById("startRecording");o&&o.addEventListener("click",Rt);const c=document.getElementById("stopRecording");c&&c.addEventListener("click",Pt)}function xt(e){const t=k.getBoundingClientRect();F=e.clientX-t.left,S=e.clientY-t.top,ve=!0,Ct()}function Tt(e){const t=k.getBoundingClientRect();F=e.clientX-t.left,S=e.clientY-t.top,ve&&(bt(),b||M())}function Lt(e){const t=k.getBoundingClientRect();F=e.clientX-t.left,S=e.clientY-t.top,ve=!1,wt()}function Ct(){if(re&&F>=0&&F<=g&&S>=0&&S<=I)V.x=F,V.y=S;else if(ee&&y&&v!==null){const e=h.find(t=>t.id===v);if(e&&e.type==="Zoom"){const t=e.data.level,r=g/t,a=I/t,o=e.data.centerX/100*g,c=e.data.centerY/100*I,n=o-r/2,d=c-a/2;F>=n&&F<=n+r&&S>=d&&S<=d+a&&(ke=!0,ye.x=F-o,ye.y=S-c)}}}function bt(){if(ke&&v!==null){const e=h.find(l=>l.id===v);if(!e||e.type!=="Zoom")return;let t=F-ye.x,r=S-ye.y;const a=e.data.level,o=g/a,c=I/a;t=Ne(t,o/2,g-o/2),r=Ne(r,c/2,I-c/2);const n=t/g*100,d=r/I*100;document.getElementById("zoomCenterX").value=n,document.getElementById("zoomCenterY").value=d,e.data.centerX=n,e.data.centerY=d,s.centerX=n,s.centerY=d,J(),b||M()}}function wt(){if(re&&F>=0&&F<=g&&S>=0&&S<=I){const e=Ae(V.x,F),t=Ae(V.y,S),r=De(V.x,F),a=De(V.y,S),o=Ze(e,t),c=Ze(r-e,a-t);s.x=o.x,s.y=o.y,s.w=c.x,s.h=c.y,s.active=!0,re=!1}ke=!1}function Ue(){y&&(i.duration,document.getElementById("zoomStartTime").max=100,document.getElementById("zoomEndTime").max=100,document.getElementById("overlayStartTime").max=100,document.getElementById("overlayEndTime").max=100)}function de(){const e=document.getElementById("cutsList");e.innerHTML="",z.forEach((t,r)=>{const a=document.createElement("div");a.textContent=`Cut ${r+1}: ${t.start.toFixed(2)}s - ${t.end.toFixed(2)}s`,e.appendChild(a)})}function Se(){const e=document.getElementById("timeline"),t=document.getElementById("current-time-display"),r=document.getElementById("time-indicator"),a=document.getElementById("time-handle"),o=document.getElementById("timeline-progress");if(!y||!e||!t)return;const c=i.duration,n=i.currentTime;t.innerHTML=`<span style="color: var(--color-text-highlight); font-family: monospace">${Ve(n)}</span> / <span style="color: var(--color-text); font-family: monospace">${Ve(c)}</span>`;const d=n/c,l=d*e.offsetWidth;o&&(o.style.width=`${d*100}%`),r&&(r.style.left=`${l}px`),a&&(a.style.left=`${l}px`),z.forEach((m,u)=>{const B=`cut-${u}`;let p=document.getElementById(B);p||(p=document.createElement("div"),p.id=B,p.className="cut-indicator",e.appendChild(p));const W=m.start/c*100,ae=(m.end-m.start)/c*100;p.style.left=`${W}%`,p.style.width=`${ae}%`});const f=h.filter(m=>m.type==="Zoom");document.querySelectorAll(".zoom-indicator").forEach(m=>{const u=m.id,B=u?parseInt(u.replace("zoom-","")):null;(!B||!f.find(p=>p.id===B))&&m.remove()}),f.forEach(m=>{const u=`zoom-${m.id}`;let B=document.getElementById(u);B||(B=document.createElement("div"),B.id=u,B.className="zoom-indicator",e.appendChild(B));const p=m.startTime/c*100,W=(m.endTime-m.startTime)/c*100;B.style.left=`${p}%`,B.style.width=`${W}%`})}let te=!1,je=!1;function kt(){const e=document.getElementById("timeline"),t=document.getElementById("time-handle");e&&(e.addEventListener("mousedown",Me),document.addEventListener("mousemove",Ft),document.addEventListener("mouseup",St),t&&t.addEventListener("mousedown",r=>{r.stopPropagation(),Me(r)}),e.addEventListener("click",zt))}function Me(e){y&&(te=!0,je=R,R&&(i.pause(),O&&C.pause()),ze(e),b||(b=requestAnimationFrame(M)))}function Ft(e){te&&ze(e)}function St(e){te&&(te=!1,je?(i.play(),O&&C.play(),R=!0,document.getElementById("playIcon").classList.add("hidden"),document.getElementById("pauseIcon").classList.remove("hidden")):b&&!R&&!ee&&(cancelAnimationFrame(b),b=null))}function zt(e){!y||te||ze(e)}function ze(e){const r=document.getElementById("timeline").getBoundingClientRect(),c=(e.clientX-r.left)/r.width*i.duration,n=Math.max(0,Math.min(c,i.duration));i.currentTime=n;for(let d of z)if(n>=d.start&&n<d.end){i.currentTime=d.end;break}n<Z?i.currentTime=Z:n>$&&(i.currentTime=$),M()}function Rt(){if(!y){alert("Please load a video first");return}if(pe){alert("Already recording");return}i.currentTime=Z,O&&(C.currentTime=0);const e=document.querySelector("canvas").captureStream();ie=new MediaRecorder(e),Le=[],ie.ondataavailable=t=>Le.push(t.data),ie.onstop=()=>{const t=new Blob(Le,{type:"video/webm"}),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download="edited-video.webm",a.click(),URL.revokeObjectURL(r)},ie.start(),i.play(),O&&C.play(),R=!0,pe=!0,document.getElementById("playIcon").classList.add("hidden"),document.getElementById("pauseIcon").classList.remove("hidden"),alert("Recording started. Press 'Stop Recording' when finished.")}function Pt(){if(!pe){alert("Not currently recording");return}ie.stop(),i.pause(),O&&C.pause(),R=!1,pe=!1,document.getElementById("playIcon").classList.remove("hidden"),document.getElementById("pauseIcon").classList.add("hidden"),alert("Recording stopped. Download will start automatically.")}function $t(){document.getElementById("zoomDuration").addEventListener("input",function(){const e=parseFloat(this.value);if(v!==null){const t=h.find(r=>r.id===v);t&&t.type==="Zoom"&&(t.data.duration=e,s.duration=e,Y())}}),document.getElementById("zoomLevel").addEventListener("input",function(){const e=parseFloat(this.value);if(v!==null){const t=h.find(r=>r.id===v);t&&t.type==="Zoom"&&(t.data.level=e,s.level=e,J(),Y())}}),document.getElementById("zoomCenterX").addEventListener("input",function(){const e=parseFloat(this.value);if(v!==null){const t=h.find(r=>r.id===v);t&&t.type==="Zoom"&&(t.data.centerX=e,s.centerX=e,J(),Y())}}),document.getElementById("zoomCenterY").addEventListener("input",function(){const e=parseFloat(this.value);if(v!==null){const t=h.find(r=>r.id===v);t&&t.type==="Zoom"&&(t.data.centerY=e,s.centerY=e,J(),Y())}}),document.getElementById("showZoomRegion").addEventListener("change",function(){ee=this.checked,ee?b||M():!R&&b&&(cancelAnimationFrame(b),b=null),M()})}function J(){if(!y)return;const e=s.level,t=g/e,r=I/e,a=s.centerX/100*g,o=s.centerY/100*I;s.x=a-t/2,s.y=o-r/2,s.w=t,s.h=r,s.active=!0;const c=h.find(n=>n.type==="Zoom");c?(c.startTime=s.startTime,c.endTime=s.endTime,c.data={level:s.level,centerX:s.centerX,centerY:s.centerY,duration:s.duration}):Qe("Zoom",s.startTime,s.endTime,{level:s.level,centerX:s.centerX,centerY:s.centerY,duration:s.duration}),Y()}function qe(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}function He(e){const t=Math.floor(e/60),r=(e%60).toFixed(1);return`${t}:${r.padStart(4,"0")}`}function Y(){const e=document.getElementById("editsTable");e.innerHTML="",h.forEach(t=>{const r=document.createElement("tr");r.className="border-b border-text/10",r.innerHTML=`
            <td class="py-2 px-4">${t.id}</td>
            <td class="py-2 px-4">${t.type}</td>
            <td class="py-2 px-4">${He(t.startTime)}</td>
            <td class="py-2 px-4">${He(t.endTime)}</td>
            <td class="py-2 px-4">
                <button class="bg-button hover:bg-button/80 text-text py-1 px-2 rounded mr-2 text-xs" 
                        onclick="editEdit(${t.id})">
                    Edit
                </button>
                <button class="bg-red-500/50 hover:bg-red-500/70 text-text py-1 px-2 rounded text-xs" 
                        onclick="deleteEdit(${t.id})">
                    Delete
                </button>
            </td>
        `,e.appendChild(r)})}function Qe(e,t,r,a={}){const o={id:Fe++,type:e,startTime:t,endTime:r,...a};h.push(o),Y()}function Xt(){document.getElementById("zoomConfig").classList.remove("hidden"),document.getElementById("cutConfig").classList.add("hidden"),document.getElementById("noEditMessage").classList.add("hidden")}function Yt(){document.getElementById("zoomConfig").classList.add("hidden"),document.getElementById("cutConfig").classList.remove("hidden"),document.getElementById("noEditMessage").classList.add("hidden")}function Mt(){document.getElementById("zoomConfig").classList.add("hidden"),document.getElementById("cutConfig").classList.add("hidden"),document.getElementById("noEditMessage").classList.remove("hidden")}function Ht(){const e=i.currentTime,t={id:Fe++,type:"Zoom",startTime:e,endTime:e+2,data:{level:2,centerX:50,centerY:50,duration:.5}};h.push(t),v=t.id,s.startTime=t.startTime,s.endTime=t.endTime,s.level=t.data.level,s.centerX=t.data.centerX,s.centerY=t.data.centerY,s.duration=t.data.duration,s.active=!0,Xt(),Wt(t),J(),Y()}function Zt(){const e=i.currentTime,t={id:Fe++,type:"Cut",startTime:e,endTime:e+1};h.push(t),v=t.id,z.push({id:t.id,start:t.startTime,end:t.endTime}),Yt(),Ot(t),de(),Y()}function Wt(e){document.getElementById("zoomStartTime").value=e.startTime,document.getElementById("zoomEndTime").value=e.endTime,document.getElementById("zoomLevel").value=e.data.level,document.getElementById("zoomCenterX").value=e.data.centerX,document.getElementById("zoomCenterY").value=e.data.centerY,document.getElementById("zoomDuration").value=e.data.duration,b||M()}function Ot(e){document.getElementById("cutStartTime").value=e.startTime,document.getElementById("cutEndTime").value=e.endTime}function _e(){const e=g/G,t=I/K;N=Math.min(e,t),g=Math.floor(G*N),I=Math.floor(K*N),Vt(g,I)}function Vt(e,t){k&&(k.width=e,k.height=t,X&&(window.OffscreenCanvas&&X instanceof OffscreenCanvas?X=new OffscreenCanvas(e,t):(X.width=e,X.height=t),A=X.getContext("2d",{alpha:!1}),A.imageSmoothingEnabled=!0,A.imageSmoothingQuality="high"),b||M())}function Ge(e,t){G=e,K=t,he=G/K,_e(),document.getElementById("currentResolution").textContent=`${G}Ã—${K}`}function Ze(e,t){return{x:e/N,y:t/N}}function q(e,t){document.getElementById("customWidth").value=e,document.getElementById("customHeight").value=t,Ge(e,t)}function Nt(){const e=parseInt(document.getElementById("customWidth").value),t=parseInt(document.getElementById("customHeight").value);if(isNaN(e)||isNaN(t)||e<100||t<100){alert("Please enter valid dimensions (minimum 100x100)");return}(e>7680||t>4320)&&!confirm("Very large resolutions may cause performance issues. Continue?")||Ge(e,t)}function We(){if(!document.getElementById("maintainAspectRatio").checked)return;const e=parseInt(document.getElementById("customWidth").value);if(!isNaN(e)){const t=Math.round(e/he);document.getElementById("customHeight").value=t}}function Oe(){if(!document.getElementById("maintainAspectRatio").checked)return;const e=parseInt(document.getElementById("customHeight").value);if(!isNaN(e)){const t=Math.round(e*he);document.getElementById("customWidth").value=t}}function Ke(e,t,r,a,o,c){if(!e)return;const n=c||Q,d=e.videoWidth,l=e.videoHeight,f=d/l,T=a/o;if(n.fillStyle="black",n.fillRect(t,r,a,o),Ee==="contain"){let m,u;f>T?(m=a,u=a/f):(u=o,m=o*f);const B=(a-m)/2,p=(o-u)/2;n.drawImage(e,t+B,r+p,m,u)}else if(Ee==="cover"){let m,u;f>T?(u=o,m=o*f):(m=a,u=a/f);const B=(a-m)/2,p=(o-u)/2;n.drawImage(e,t+B,r+p,m,u)}}function we(e){Ee=e}function Ve(e){const t=Math.floor(e/3600),r=Math.floor(e%3600/60),a=Math.floor(e%60),o=Math.floor(e%1*1e3);return e>=3600?`${t}:${r.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}.${o.toString().padStart(3,"0")}`:`${r}:${a.toString().padStart(2,"0")}.${o.toString().padStart(3,"0")}`}function Ne(e,t,r){return Math.max(t,Math.min(r,e))}function Ae(e,t){return Math.min(e,t)}function De(e,t){return Math.max(e,t)}function _(e,t,r,a,o){return a+(o-a)*((e-t)/(r-t))}function At(){const t=document.getElementById("videoInput").getAttribute("data-default-video");t&&(i.src=t,i.onloadedmetadata=()=>{y=!0,i.volume=0,document.getElementById("trimEnd").value=100,$=i.duration,document.getElementById("trimEndValue").textContent=$.toFixed(1),Ue(),Se(),M()})}window.onload=function(){Et()};
